spring:
  application:
    name: API-gateway

  security:
    oauth2:
      client:
        registration:
          keycloak:
            provider: keycloak
            client-id: gateway-client
            client-secret: FhZynRb715RaePXDIBPO7gNHnwZe4K35
            authorization-grant-type: authorization_code
            redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
            scope:
              - openid
              - profile
        provider:
          keycloak:
            issuer-uri: ${IAM_URL}
            user-name-attribute: preferred_username
  cloud:
    gateway:
      mvc:
        routes:
          - id: reservation-service
            uri: ${RESERVATIONSERVICE_URL}
            predicates:
              - Path=/api/v1/reservation-service/**
            filters:
              - RewritePath=/api/v1/reservation-service/?(?<segment>.*), /api/v1/$\{segment}
              - TokenRelay=
              - SetResponseHeader=Route-Matched, reservation-service
          - id: user-service
            uri: ${USERSERVICE_URL}
            predicates:
              - Path=/api/v1/user-service/**
            filters:
              - RewritePath=/api/v1/user-service/?(?<segment>.*), /api/v1/$\{segment}
              - TokenRelay=
              - SetResponseHeader=Route-Matched, reservation-service
          - id: payment-service
            uri: ${PAYMENTSERVICE_URL}
            predicates:
              - Path=/api/v1/payment-service/**
            filters:
              - RewritePath=/api/v1/payment-service/?(?<segment>.*), /api/v1/$\{segment}
              - TokenRelay=
              - SetResponseHeader=Route-Matched, reservation-service
          - id: analytics-service
            uri: ${ANALYTICSSERVICE_URL}
            predicates:
              - Path=/api/v1/analytics-service/**
            filters:
              - RewritePath=/api/v1/analytics-service/?(?<segment>.*), /api/v1/$\{segment}
              - TokenRelay=
              - SetResponseHeader=Route-Matched, reservation-service
          - id: tracking-service
            uri: ${TRACKINGSERVICE_URL}
            predicates:
              - Path=/api/v1/tracking-service/**
            filters:
              - RewritePath=/api/v1/tracking-service/?(?<segment>.*), /api/v1/$\{segment}
              - TokenRelay=
              - SetResponseHeader=Route-Matched, reservation-service
          - id: ui
            uri: ${UI_URL}
            predicates:
              - Path=/ui/**
            filters:
              - RewritePath=/ui/?(?<segment>.*), /ui/$\{segment}
              - AddRequestHeader=X-Debug, true
              - SetResponseHeader=Route-Matched, ui

UI_URL: "http://localhost:4173"
RESERVATIONSERVICE_URL: "http://localhost:8080"
USERSERVICE_URL: "http://localhost:8081"
PAYMENTSERVICE_URL: "http://localhost:8082"
ANALYTICSSERVICE_URL: "http://localhost:8084"
TRACKINGSERVICE_URL: "http://localhost:8085"
IAM_URL: "http://localhost:9090/realms/car-rental-system"
